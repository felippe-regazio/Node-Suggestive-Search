/* eslint-disable node/no-unsupported-features */
let nss = require('./index.js').init();

const _ = require('lodash');

let items = [
    {"word":"ivam","results":[
        {"words":["Ivah"],"cleanWord":"ivah","items":["3290","4583","18998","31253","39429","39490","42515","43955","44462","45277","45673","47441","48049","49901"],"similarity":0.75,"word":"Ivah"},
        {"words":["Ivan"],"cleanWord":"ivan","items":["49999","50000","50001","50002"],"similarity":0.75,"word":"Ivan"},
        {"words":["Iva"],"cleanWord":"iva","items":["1210","1402","10313","16822","17040","20731","27193","28511","29395","33363","34856","38236","40173","40734","40976","42481","49383","49837"],"similarity":0.75,"word":"Iva"},
        {"words":["Hiram"],"cleanWord":"hiram","items":["527","3831","6469","7875","9925","12166","12352","13590","15398","18397","25284","27455","27811","33222","34484","37814","40689","40706","43408","44886","48512","49315"],"similarity":0.6,"word":"Hiram"},
        {"words":["Sam"],"cleanWord":"sam","items":["296","1417","3866","5369","9760","15192","18975","19061","21725","21822","25501","28917","35351","42130","48062","48661","49943"],"similarity":0.5,"word":"Sam"},
        {"words":["IV"],"cleanWord":"iv","items":["34","67","355","398","467","478","507","630","867","927","1021","1144","1152","1191","1249","1252","1319","1435","1576","1740","1775","1841","1931","1953","2026","2067","2236","2342","2538","2565","2931","2932","2939","2985","3031","3069","3090","3091","3119","3125","3178","3278","3306","3449","3531","3747","3756","3907","3924","4110","4114","4135","4182","4345","4346","4361","4397","4414","4447","4448","4458","4729","4803","4883","4886","4969","5107","5118","5373","5487","5490","5511","5542","5584","5638","5683","5785","5809","5985","6213","6547","6604","6883","6985","7102","7165","7229","7235","7258","7361","7409","7601","7690","7732","7751","7980","8059","8082","8171","8229","8280","8282","8320","8431","8510","8520","8652","8714","8733","8737","8950","9046","9133","9243","9250","9370","9489","9851","9871","9889","9891","10004","10047","10190","10456","10600","10889","10914","11142","11237","11329","11493","11558","11559","11655","11669","11739","11919","12036","12141","12276","12395","12508","12694","12774","12978","12997","13000","13010","13124","13138","13140","13207","13254","13427","13443","13640","13694","13851","13983","13999","14041","14064","14115","14195","14272","14401","14403","14412","14479","14718","14779","14799","14829","14901","14915","14924","15397","15410","15421","15514","15547","15692","15773","15782","15899","16123","16156","16176","16229","16311","16361","16395","16440","16537","16582","16608","16668","16674","16787","16802","16897","16977","17095","17103","17188","17250","17327","17351","17374","17441","17580","17752","17807","18040","18223","18325","18385","18474","18517","18561","18589","18605","18678","18835","18856","18880","18897","18953","19057","19196","19335","19616","19642","19645","19809","19829","19892","19934","19992","20162","20232","20332","20341","20349","20475","20681","20882","20935","20996","21020","21176","21216","21221","21532","21629","21760","21832","21862","21863","21947","22155","22161","22392","22458","22507","22615","22617","22648","22653","22657","22722","22735","22746","22747","22962","23135","23199","23542","23708","23981","24006","24136","24180","24311","24321","24485","24517","24638","24813","24846","24867","24875","24973","25023","25052","25055","25156","25160","25161","25175","25315","25380","25569","25616","25632","25741","25955","25991","26028","26092","26153","26370","26389","26420","26638","26790","26940","26990","27068","27088","27160","27190","27228","27306","27464","27491","27578","27770","27787","28141","28380","28394","28940","28965","28993","29135","29145","29147","29169","29198","29232","29299","29437","29469","29523","29822","30258","30289","30370","30530","30619","30697","30755","30767","30895","30899","31127","31147","31378","31382","31477","31484","31506","31747","31842","31906","31908","32154","32238","32483","32489","32526","32648","32789","32811","32855","33426","33529","33602","33677","33709","33966","33988","34064","34172","34245","34313","34337","34429","34450","34461","34485","34595","34646","34675","34778","34836","35092","35173","35285","35440","35525","35543","35666","36029","36111","36183","36308","36469","36573","36580","36613","36658","36878","36889","36898","37033","37142","37145","37187","37383","37388","37426","37431","37437","37438","37525","37677","37744","37787","37993","38023","38207","38284","38406","38665","38955","39021","39035","39041","39308","39394","39731","39761","39950","39955","40062","40158","40165","40178","40185","40200","40204","40340","40346","40490","40528","40861","41145","41294","41331","41339","41357","41496","41533","41572","41584","41641","41718","41812","41878","41985","42008","42104","42136","42140","42179","42254","42293","42380","42630","42668","42738","42786","42977","43225","43412","43456","43559","43671","43966","43999","44009","44060","44139","44249","44302","44306","44464","44539","44548","44560","44636","44807","44867","45204","45224","45306","45346","45369","45460","45471","45498","45626","45774","45846","45916","46005","46048","46103","46341","46383","46449","46664","46792","46800","46837","46913","47091","47163","47215","47228","47313","47319","47457","47458","47594","47595","47601","47732","47801","47846","47950","48196","48300","48352","48358","48446","48629","48716","48910","49085","49414","49588","49658"],"similarity":0.5,"word":"IV"},
        {"words":["Liam"],"cleanWord":"liam","items":["1118","5195","6120","6536","7149","10764","14249","20360","28651","31908","33602","40112","40412","46251","49728"],"similarity":0.5,"word":"Liam"},
        {"words":["Ivy"],"cleanWord":"ivy","items":["3229","6226","8182","9197","12035","19707","20979","22907","26438","28865","33570","35676","37943","41165","43116","44920","45875","47371"],"similarity":0.5,"word":"Ivy"},
        {"words":["Adam"],"cleanWord":"adam","items":["2362","2575","5919","11042","15003","16704","39358","41235","41995","42559","43709","46265"],"similarity":0.5,"word":"Adam"},
        {"words":["William"],"cleanWord":"william","items":["3152","4141","4331","5425","7985","14944","15068","16281","18026","23245","26201","30680","35170","36884","40592","43336","48787","48877"],"similarity":0.42857142857142855,"word":"William"},
        {"words":["Smitham"],"cleanWord":"smitham","items":["22","96","377","618","3871","4448","4774","5283","5315","5921","6083","6603","6716","8397","9996","10311","10761","11269","13122","13231","13467","13480","14001","14035","14120","14952","15335","15361","15714","15768","16322","16731","17648","17700","18260","18342","18985","19429","19745","20097","20128","20773","20983","21749","21934","23167","23325","23680","24019","24120","24138","24291","24670","24819","25771","26162","28195","28514","28621","28631","28969","29498","30272","30916","31122","32041","32054","32273","32284","32833","32951","33184","33634","33700","34238","34697","34889","34980","35701","35705","36705","37363","37588","37666","37904","37957","37995","38256","38350","38920","38992","39459","39664","39667","40832","41826","41985","42784","43255","43755","43962","44432","44656","44736","45003","45008","45970","47265","47512","47764","48050","48311","48646","49738","49745"],"similarity":0.42857142857142855,"word":"Smitham"},
        {"words":["Ivory"],"cleanWord":"ivory","items":["1630","1693","1957","3000","3949","4318","4686","9021","17086","19071","19579","23406","24867","29865","32018","36846","43074","46391"],"similarity":0.4,"word":"Ivory"},
        {"words":["Maryam"],"cleanWord":"maryam","items":["2667","5563","6338","8600","14973","15527","15724","16374","19124","19519","21779","24190","26956","28258","29536","29827","30388","31820","32728","35895","38037","38088","39736","47366"],"similarity":0.3333333333333333,"word":"Maryam"},
        {"words":["Graham"],"cleanWord":"graham","items":["34","907","1398","1542","2354","2704","3234","3606","3963","4027","6125","6167","6836","6919","7329","7750","7941","8168","8275","8504","8790","8925","10113","10643","10644","11298","11703","13706","14389","14640","15843","16139","16441","16588","16981","17760","18073","18333","18441","18723","18870","19277","19474","19610","20581","21125","21564","21646","21671","21765","22760","22811","22895","23110","23193","23568","23831","23972","24754","25181","25641","25918","26270","26703","27545","28616","28814","28991","29197","30206","30223","30409","30551","30952","30960","31586","31652","33658","33854","33863","33872","34075","34586","34767","34773","35620","35735","36444","36696","36843","37155","37263","37367","37586","37717","38429","38481","38568","38605","40750","40757","40887","40908","41114","41242","42858","43080","43205","43455","43859","44911","45547","46074","46124","46585","46846","47203","47222","47290","47648","47812","48444","48787","48854","49082"],"similarity":0.3333333333333333,"word":"Graham"},
        {"words":["Mariam"],"cleanWord":"mariam","items":["3875","4246","6147","9315","21457","24374","25619","29013","42050","47749"],"similarity":0.3333333333333333,"word":"Mariam"},
        {"words":["Myriam"],"cleanWord":"myriam","items":["2225","8717","9809","11652","15826","20881","26621","27878","29354","30448","33487","33496","34598","36045","42009","46854","49033"],"similarity":0.3333333333333333,"word":"Myriam"},
        {"words":["Abraham"],"cleanWord":"abraham","items":["3554","5814","6587","7518","8984","13757","19308","20712","20877","23656","23708","24496","30139"],"similarity":0.2857142857142857,"word":"Abraham"},
        {"words":["Bertram"],"cleanWord":"bertram","items":["11624","12248","13109","13694","16874","17952","27493","28503","31225","35395","36316","37471","38624","42942","43085","46014","47540","49007"],"similarity":0.2857142857142857,"word":"Bertram"}
    ]},
    {"word":"valadar","results":[
        {"words":["Valadares"],"cleanWord":"valadares","items":["49999"],"similarity":0.7777777777777778,"word":"Valadares"},
        {"words":["Vada"],"cleanWord":"vada","items":["4025","6404","10230","16110","17061","18464","19623","20277","21881","24339","26316","27583","31752","32048","32938","33386","34274","37277","39436","39745","41252"],"similarity":0.5714285714285714,"word":"Vada"},
        {"words":["Lamar"],"cleanWord":"lamar","items":["5930","9825","10511","10658","11956","12884","13193","13559","18969","21926","27175","36145","36486","40908","41532","42056","42257","44609","46119","49059","49396","49831"],"similarity":0.5714285714285714,"word":"Lamar"},
        {"words":["Jamar"],"cleanWord":"jamar","items":["6314","10720","11916","15642","16684","26768","31516","37377","37823","38734","40195","43738","48255"],"similarity":0.42857142857142855,"word":"Jamar"},
        {"words":["Ceasar"],"cleanWord":"ceasar","items":["4342","5685","6425","9236","10675","10918","13748","15213","18509","23686","25330","27552","32151","33184","40788","42048","42447","44119"],"similarity":0.42857142857142855,"word":"Ceasar"},
        {"words":["Caesar"],"cleanWord":"caesar","items":["904","3902","5183","10281","11031","18229","28159","30469","33933","37141","37373","38706","40692","41806","47347"],"similarity":0.42857142857142855,"word":"Caesar"},
        {"words":["Vallie"],"cleanWord":"vallie","items":["978","10869","11745","20119","20688","21237","21645","23316","26760","29277","37456"],"similarity":0.42857142857142855,"word":"Vallie"},
        {"words":["Valerie"],"cleanWord":"valerie","items":["761","2035","4523","8748","12688","14110","14975","15162","20515","22807","22823","22935","30565","32149","34331","42844","44825","47851","49436"],"similarity":0.42857142857142855,"word":"Valerie"},
        {"words":["Valente"],"cleanWord":"valente","items":["50001"],"similarity":0.42857142857142855,"word":"Valente"},
        {"words":["Dagmar"],"cleanWord":"dagmar","items":["2027","7642","8917","13084","18635","24588","26032","28210","31067","31884","33817","35230","39154"],"similarity":0.42857142857142855,"word":"Dagmar"},
        {"words":["Eleazar"],"cleanWord":"eleazar","items":["9500","9850","15838","17740","19615","31142","32460","33941","36078","45871"],"similarity":0.42857142857142855,"word":"Eleazar"},
        {"words":["Valentin"],"cleanWord":"valentin","items":["2235","7852","15057","15214","16700","17104","26900","31481","39099","46172"],"similarity":0.375,"word":"Valentin"},
        {"words":["Aufderhar"],"cleanWord":"aufderhar","items":["33","315","922","1941","2228","2405","3428","3860","4241","4628","6096","7000","7204","7321","7441","7587","8040","9262","9803","10368","10892","10975","11398","11496","14146","14293","14956","16206","16633","16891","16955","17294","17951","18630","19045","20398","20651","20701","21236","21487","22241","22644","22964","23667","24323","24993","25939","27084","27966","28161","28375","28682","29649","29695","30553","30738","31699","32631","33007","33259","33308","33384","33468","33686","33918","34027","35889","37352","39548","41309","42318","42594","42633","42668","43686","44372","44570","44659","44835","45384","45569","45576","46060","47072","47568","47683","47793","47826","47939","48165","48266","48450","49311","49318","49651","49768","49973"],"similarity":0.3333333333333333,"word":"Aufderhar"},
        {"words":["Valentina"],"cleanWord":"valentina","items":["706","3269","5000","22711","23925","24117","27197","27499","28172","29637","29860","32336","34734","41895","47215","47569","48888","49824"],"similarity":0.3333333333333333,"word":"Valentina"},
        {"words":["Valentine"],"cleanWord":"valentine","items":["4292","10635","12474","17432","18015","25042","30069","33645","34439","36889","39654","43209"],"similarity":0.3333333333333333,"word":"Valentine"},
        {"words":["Valentino"],"cleanWord":"valentino","items":["50002"],"similarity":0.3333333333333333,"word":"Valentino"},
        {"words":["Vandervort"],"cleanWord":"vandervort","items":["424","1858","2516","3892","4294","6220","6493","6788","7354","8366","8633","8739","8776","9376","9532","9627","9865","10106","10169","11099","11201","11217","11242","11573","11675","11681","12189","12196","12957","13418","13682","13946","13988","15028","15157","15160","15757","15943","15948","17002","17304","17471","18319","18737","18907","19083","19119","19155","19599","19622","20265","20692","20693","20736","20747","20798","20853","20911","20945","21327","21414","21471","21776","22118","22171","22952","23413","23643","23778","24097","24732","24755","25053","25088","25215","26466","26769","26817","27995","28068","28627","28791","29126","29919","30090","30736","30970","31130","31214","32459","32828","32959","33119","33601","33933","34001","34255","34261","34435","36168","36791","36876","36955","37239","37342","37695","38014","39109","39411","39696","40443","41699","42567","43143","43271","43653","43807","44497","44675","44729","45554","45685","46474","47128","47424","47893","47963","48230","48781","49051","49191"],"similarity":0.3,"word":"Vandervort"},
        {"words":["Vaughn"],"cleanWord":"vaughn","items":["578","645","1068","2443","10374","15390","23666","24151","32717","37669","40950","42475","42480","42921","44816","45453","46292","47728","48605","49236"],"similarity":0.2857142857142857,"word":"Vaughn"},
        {"words":["Oscar"],"cleanWord":"oscar","items":["5984","6246","10415","11275","15914","17477","17481","19711","23368","24936","25908","26746","31846","34064","35034","35888","38794","40787","41576","42192","45206","46709","47827","48254","48687","49001","49816"],"similarity":0.2857142857142857,"word":"Oscar"},
        {"words":["Vance"],"cleanWord":"vance","items":["1681","3234","4564","5925","7442","7511","7534","14552","16425","18409","22192","23370","23378","27159","34723","37216","38495","38735","38961","39106","45024","47356"],"similarity":0.2857142857142857,"word":"Vance"},
        {"words":["Vanessa"],"cleanWord":"vanessa","items":["1356","1629","4383","6723","11046","12152","13057","24652","26324","27763","30751","34857","39189","40109","43207","45941","47228","47242","47818","48599"],"similarity":0.2857142857142857,"word":"Vanessa"},
        {"words":["Edgar"],"cleanWord":"edgar","items":["4562","5921","8480","12408","12721","14711","22887","25419","32864","38567","42471","42893","44470","48527"],"similarity":0.2857142857142857,"word":"Edgar"},
        {"words":["Skylar"],"cleanWord":"skylar","items":["3491","3676","10294","12870","13378","19296","20491","25165","29099","30863","32499","33385","34921","35077","35424","35994","37914","39076","39716","44087","47031"],"similarity":0.2857142857142857,"word":"Skylar"},
        {"words":["Einar"],"cleanWord":"einar","items":["3839","7833","8119","11585","11872","13411","14643","15951","19960","21693","22359","22755","25331","36054","40823","42544","44673","45456","47955"],"similarity":0.2857142857142857,"word":"Einar"},
        {"words":["Morar"],"cleanWord":"morar","items":["503","676","836","1236","2010","3191","3547","3946","4054","4459","4753","4812","5333","5827","5846","6024","6420","7668","7969","8269","8619","10355","10386","10970","12052","12097","12399","12798","13274","13371","13827","14569","15474","15552","15727","15977","16297","16448","16713","17504","18133","20471","20534","20544","21007","21896","22254","23003","24141","24437","24439","24663","26128","27245","27282","27420","27571","28615","28977","29034","29207","29316","29357","30387","30687","30710","31467","31857","32648","32879","33897","34152","35762","35799","36915","37154","37209","39022","39067","39106","39185","39206","41245","41376","41847","42547","42642","43300","43623","43707","44435","44747","44769","45252","45418","45596","45646","45711","45820","46087","46443","47218","48398","48590","48773","48829","48850","49437","49704","49856"],"similarity":0.2857142857142857,"word":"Morar"},
        {"words":["Shemar"],"cleanWord":"shemar","items":["3243","5190","7175","12255","12844","16625","19339","32565","35943","36917","38425","38975","45415","46205","46359","48296"],"similarity":0.2857142857142857,"word":"Shemar"},
        {"words":["Van"],"cleanWord":"van","items":["1914","4225","7146","10538","11246","12463","13295","16740","19164","19949","20796","25870","26253","30204","38651","42583","45460"],"similarity":0.2857142857142857,"word":"Van"},
        {"words":["Gunnar"],"cleanWord":"gunnar","items":["614","9436","9496","17907","27370","28909","30231","30463","31937","32878","40718","43553","48629","48894"],"similarity":0.2857142857142857,"word":"Gunnar"},
        {"words":["Cesar"],"cleanWord":"cesar","items":["6255","9771","17076","19535","20376","23883","26967","27015","32789","37789","41037","41811","45396","46276","46614","47447","47597","48373"],"similarity":0.2857142857142857,"word":"Cesar"},
        {"words":["Bednar"],"cleanWord":"bednar","items":["345","1353","2111","2232","2912","3316","3563","3684","3935","4316","5520","5950","6356","6968","7041","7289","7568","8613","9154","9274","9466","9482","10785","10859","11126","11756","12427","12628","13141","14072","14764","15780","15806","16193","16930","17359","17985","18011","18683","18704","19099","19355","21552","21790","22329","22376","23651","23668","23996","24692","25111","25156","25362","26284","26589","27499","27545","28530","28783","28899","29005","29677","29867","29955","30530","30607","31088","31278","31785","32151","32953","33861","33916","34064","34839","34977","35339","37148","38819","40952","41615","42736","42830","44040","45272","45587","46583","46713","47209","48357","48418","48810","49139","49454","49546","49785"],"similarity":0.2857142857142857,"word":"Bednar"},
        {"words":["Bechtelar"],"cleanWord":"bechtelar","items":["567","790","1425","2447","3427","3646","4513","4636","4961","5172","7315","7455","7781","8088","8889","8957","10899","11430","11632","11927","12395","12791","14132","14193","14868","15973","15974","16223","16995","17231","17441","18580","18695","18810","18886","18954","19017","19417","20173","20316","20379","21005","21437","21838","21985","22734","23365","23434","23547","24176","24504","24608","25582","26237","26965","27318","27325","27478","28706","29743","29993","30505","31107","31585","31748","33313","33647","34476","35517","36918","37035","37353","37757","38424","38812","39456","40113","40217","40268","40270","40681","41026","41665","42625","42647","43215","43574","43588","43994","44111","44477","45048","45265","45742","46794","47981","49061","49862"],"similarity":0.2222222222222222,"word":"Bechtelar"}
    ]}
];

const _intersection = (arrays, mustMatchLength) => {
    let output = [];
    let cntObj = {};
    let array, cnt, item;
    for (let i = 0; i < arrays.length; i++) {
        array = arrays[i];
        for (let j = 0; j < array.length; j++) {
            item = array[j];
            cnt = cntObj[item] || 0;
            // if cnt is exactly the number of previous arrays, 
            // then increment by one so we count only one per array
            if (cnt == i) {
                cntObj[item] = cnt + 1;
            }
        }
    }

    for (item in cntObj) {
        if (cntObj[item] === mustMatchLength) {
            output.push(item);
        }
    }
    return(output);
};



let arrItems = items.map(w => {
    if (w.results && w.results.length === 0) {
        return [];
    }

    return _.flatten(w.results.map(i => {
        return i.items;
    }));
    
});

let commonItemsIds = _intersection(arrItems, arrItems.length);

console.log(commonItemsIds);


// nss.on("initialized", async () => {

//     await nss.loadJson("./test/names.json");

//     let q = await nss.query("ivam valadar");

//     console.log(q);

// });